---
layout: default
---

<link rel="stylesheet" href="{{ site.baseurl }}/assets/css/diary-book.css">

<article class="diary-entry">
  <!-- 見開きブック（左: メタ/ツール、右: 本文） -->
  <div class="book-spread" role="region" aria-label="Diary entry book view">
    <!-- 左ページ（メタ / ツール / ナビ） -->
    <aside class="page left-page" aria-labelledby="meta-heading">
      <div class="page-inner">
        <h2 id="meta-heading" class="page-small-title">Drowse‑Lab</h2>

        <div class="meta-block">
          <p class="meta">
            <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y-%m-%d" }}</time>
            {% if page.author %} · by
              <a href="{{ site.baseurl }}/diary/?author={{ page.author | downcase }}">{{ page.author }}</a>
            {% endif %}
          </p>
        </div>

        <!-- ツールバー（日付ピッカー等） -->
        <div class="entry-toolbar" data-author="{{ page.author | downcase }}">
          <label>Open by date
            <input id="entryDate" type="date" value="{{ page.date | date: '%Y-%m-%d' }}">
          </label>
          <button id="entryOpenBtn">Open</button>
          <div class="spacer"></div>
          <a id="prevLink" class="nav-btn" href="#" hidden>← Prev</a>
          <a id="nextLink" class="nav-btn" href="#" hidden>Next →</a>
        </div>

        <!-- 左ページ下部に一覧的な抜粋や著者紹介などを出す余地 -->
        <div class="left-excerpt">
          <p>投稿者: <strong>{{ page.author }}</strong></p>
          {% if page.excerpt %}
            <p class="excerpt">{{ page.excerpt | strip_html | truncate: 160 }}</p>
          {% endif %}
        </div>
      </div>
    </aside>

    <!-- 右ページ（本文） -->
    <section class="page right-page" aria-labelledby="entry-title">
      <div class="page-inner">
        <header>
          <h1 id="entry-title">{{ page.title }}</h1>
        </header>

        <div class="content">
          {{ content }}
        </div>

        <hr class="diary-divider">

        <!-- ページ下部の「前の記事 / 次の記事」ナビ（従来ロジックを維持） -->
        <nav class="diary-nav">
          {% assign entries = site.diary | where: "author", page.author | sort: "date" %}
          {% for post in entries %}
            {% if post.url == page.url %}
              {% assign index = forloop.index0 %}
              {% assign prev = entries[index-1] %}
              {% assign next = entries[index+1] %}
            {% endif %}
          {% endfor %}
          {% if prev %}
            <a class="prev" href="{{ prev.url | relative_url }}">← 前の記事：{{ prev.title }}</a>
          {% endif %}
          {% if next %}
            <a class="next" href="{{ next.url | relative_url }}">次の記事：{{ next.title }} →</a>
          {% endif %}
        </nav>
      </div>
    </section>
  </div>
</article>

<script>
/* 既存の ENTRIES データ埋め込み（そのまま利用） */
const ENTRIES = [
{% assign entries_all = site.diary | sort: 'date' %}
{% for p in entries_all %}
  { a: "{{ p.author | downcase }}", d: "{{ p.date | date: '%Y-%m-%d' }}", u: "{{ p.url | relative_url }}", t: {{ p.title | jsonify }} }{% unless forloop.last %},{% endunless %}
{% endfor %}
];

(function(){
  const bar = document.querySelector('.entry-toolbar');
  const author = bar?.dataset.author;
  if(!author) return;

  const list = ENTRIES.filter(e => e.a === author).sort((x,y)=> x.d.localeCompare(y.d));
  const today = "{{ page.date | date: '%Y-%m-%d' }}";
  const idx = list.findIndex(e => e.d === today);

  const prev = list[idx-1], next = list[idx+1];
  const prevLink = document.getElementById('prevLink');
  const nextLink = document.getElementById('nextLink');
  if(prev){ prevLink.href = prev.u; prevLink.hidden = false; }
  if(next){ nextLink.href = next.u; nextLink.hidden = false; }

  document.getElementById('entryOpenBtn').addEventListener('click', ()=>{
    const target = document.getElementById('entryDate').value;
    if(!target) return;
    let pick = list.find(e => e.d === target);
    if(!pick) pick = list.find(e => e.d >= target) || list[list.length-1];
    location.href = pick.u;
  });
})();
</script>