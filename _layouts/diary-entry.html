---
layout: default
---
<article class="diary-entry">
  <header>
    <h1>{{ page.title }}</h1>
    <p class="meta">
      <time datetime="{{ page.date | date_to_xmlschema }}">{{ page.date | date: "%Y-%m-%d" }}</time>
      {% if page.author %} · by
        <a href="{{ site.baseurl }}/diary/?author={{ page.author | downcase }}">{{ page.author }}</a>
      {% endif %}
    </p>
  </header>

  <div class="entry-toolbar" data-author="{{ page.author | downcase }}">
    <label>Open by date
      <input id="entryDate" type="date" value="{{ page.date | date: '%Y-%m-%d' }}">
    </label>
    <button id="entryOpenBtn">Open</button>
    <span class="spacer"></span>
    <a id="prevLink" class="nav-btn" href="#" hidden>← Prev</a>
    <a id="nextLink" class="nav-btn" href="#" hidden>Next →</a>
  </div>

  <div class="content">{{ content }}</div>
</article>

<script>
const ENTRIES = [
{% assign entries_all = site.diary | sort: 'date' %}
{% for p in entries_all %}
  { a: "{{ p.author | downcase }}", d: "{{ p.date | date: '%Y-%m-%d' }}", u: "{{ p.url | relative_url }}", t: {{ p.title | jsonify }} }{% unless forloop.last %},{% endunless %}
{% endfor %}
];

(function(){
  const bar = document.querySelector('.entry-toolbar');
  const author = bar?.dataset.author;
  if(!author) return;
  const list = ENTRIES.filter(e => e.a === author).sort((x,y)=> x.d.localeCompare(y.d));
  const today = "{{ page.date | date: '%Y-%m-%d' }}";
  const idx = list.findIndex(e => e.d === today);

  const prev = list[idx-1], next = list[idx+1];
  if(prev){ prevLink.href = prev.u; prevLink.hidden = false; }
  if(next){ nextLink.href = next.u; nextLink.hidden = false; }

  entryOpenBtn.addEventListener('click', ()=>{
    const target = entryDate.value;
    if(!target) return;
    let pick = list.find(e => e.d === target);
    if(!pick) pick = list.find(e => e.d >= target) || list[list.length-1];
    location.href = pick.u;
  });
})();
</script>
