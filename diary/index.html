---
layout: default
title: Diary
permalink: /diary/
---  

<link rel="stylesheet" href="{{ '/assets/css/diary.css' | relative_url }}">
<link rel="manifest" href="{{ '/assets/data/manifest.json' | relative_url }}" />
<div class="diary container">
  <!-- 3D Book Shelf -->
  <section class="book-shelf" aria-label="Members">
    <div class="shelf-rail" id="shelfRail"></div>
  </section>
</div>

<script>
/* 全エントリ（昇順）をJSへ埋め込み */
const ENTRIES = [
{% assign entries_all = site.diary | sort: 'date' %}
{% for p in entries_all %}
  { a: "{{ p.author | downcase }}", d: "{{ p.date | date: '%Y-%m-%d' }}", u: "{{ p.url | relative_url }}", t: {{ p.title | jsonify }} }{% unless forloop.last %},{% endunless %}
{% endfor %}
];

(function(){
  const shelfRail = document.getElementById('shelfRail');

  const entriesOf = (author) =>
    ENTRIES.filter(e => e.a === author).sort((x,y)=> x.d.localeCompare(y.d));

  function hueFrom(str){
    let h = 0; for (let i=0;i<str.length;i++) h = (h*31 + str.charCodeAt(i)) >>> 0;
    return h % 360;
  }

  function escapeHTML(s){
    return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c]));
  }

  fetch('{{ site.baseurl }}/assets/data/members.json', {cache:'no-store'})
    .then(r => r.json())
    .then(list => {
      list.forEach(m => {
        const link = (m.github_link || m.github || '');
        const parts = link.split('/').filter(Boolean);
        const fromLink = parts[parts.length-1] || '';
        const rawUsername = (m.username || fromLink || m.login || '').toString().trim();
        const usernameKey = rawUsername.replace(/^@/, '').toLowerCase();

        const displayRaw = (m.name && m.name.toString().trim()) || (m.username && m.username.toString().trim()) || fromLink || 'unknown';
        const displayLabel = displayRaw.slice(0, 16); // 少し長めでも収まるように調整

        const btn = document.createElement('button');
        btn.className = 'book';
        btn.dataset.username = usernameKey || '';
        btn.title = (m.name || m.username || fromLink || 'unknown');
        const h = hueFrom(displayLabel);

        // 背表紙内に装飾用要素を入れる（CSSで革質感・金帯を表現）
        btn.innerHTML = `
          <span class="book-spine" style="--h:${h}">
            <span class="spine-decor" aria-hidden="true"></span>
            <span class="spine-band top" aria-hidden="true"></span>
            <span class="spine-band bottom" aria-hidden="true"></span>
            <span class="book-title"><span class="label">${escapeHTML(displayLabel)}</span></span>
          </span>`;
        shelfRail.appendChild(btn);
      });
    });

  shelfRail.addEventListener('click', (e)=>{
    const btn = e.target.closest('.book');
    if(!btn) return;
    const author = btn.dataset.username;
    if(!author) return;
    const list = entriesOf(author);
    if(list.length === 0) return;
    location.href = list[0].u;
  });
})();
</script>
