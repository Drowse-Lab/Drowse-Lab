---
layout: default
title: Diary
permalink: /diary/
---

<link rel="stylesheet" href="{{ site.baseurl }}/assets/css/diary.css">

<div class="diary container">
  <!-- 3D Book Shelf -->
  <section class="book-shelf" aria-label="Members">
    <div class="shelf-rail" id="shelfRail"></div>
  </section>
</div>

<script>
/* 全エントリ（昇順）をJSへ埋め込み */
const ENTRIES = [
{% assign entries_all = site.diary | sort: 'date' %}
{% for p in entries_all %}
  { a: "{{ p.author | downcase }}", d: "{{ p.date | date: '%Y-%m-%d' }}", u: "{{ p.url | relative_url }}", t: {{ p.title | jsonify }} }{% unless forloop.last %},{% endunless %}
{% endfor %}
];

(function(){
  const shelfRail = document.getElementById('shelfRail');

  const entriesOf = (author) =>
    ENTRIES.filter(e => e.a === author).sort((x,y)=> x.d.localeCompare(y.d));

  // 安定色（色相）を username から生成
  function hueFrom(str){
    let h = 0; for (let i=0;i<str.length;i++) h = (h*31 + str.charCodeAt(i)) >>> 0;
    return h % 360;
  }
  // 縦組み
  const lettersHTML = (s) => s.split('').map(c=>`<span class="ch">${c}</span>`).join('');

  // members.json を読み込んで本を描画
  fetch('{{ site.baseurl }}/assets/data/members.json', {cache:'no-store'})
    .then(r => r.json())
    .then(list => {
      list.forEach(m => {
        const parts = (m.github_link || '').split('/');
        const username = (parts[parts.length-1] || '').toLowerCase();
        if(!username) return;

        const btn = document.createElement('button');
        btn.className = 'book';
        btn.dataset.username = username;
        btn.title = username;
        const h = hueFrom(username);
        btn.innerHTML = `
          <span class="book-spine" style="--h:${h}">
            <span class="book-title">${lettersHTML(username)}</span>
          </span>`;
        shelfRail.appendChild(btn);
      });
    });

  // クリック → その人の最古記事へ
  shelfRail.addEventListener('click', (e)=>{
    const btn = e.target.closest('.book');
    if(!btn) return;
    const author = btn.dataset.username;
    const list = entriesOf(author);
    if(list.length === 0) return;
    location.href = list[0].u;
  });
})();
</script>
